import math, copy, glob, os, sys, pickle
from heapq import heappush, heappop, heapify
from collections import defaultdict
from copy import *

INT_MAX = 65535

bits_ac_luminance = [0, 0, 2, 1, 3, 3, 2, 4, 3, 5, 5, 4, 4, 0, 0, 1, 0x7d]
val_ac_luminance = [ 0x01, 0x02, 0x03, 0x00, 0x04, 0x11, 0x05, 0x12,
      0x21, 0x31, 0x41, 0x06, 0x13, 0x51, 0x61, 0x07,
      0x22, 0x71, 0x14, 0x32, 0x81, 0x91, 0xa1, 0x08,
      0x23, 0x42, 0xb1, 0xc1, 0x15, 0x52, 0xd1, 0xf0,
      0x24, 0x33, 0x62, 0x72, 0x82, 0x09, 0x0a, 0x16,
      0x17, 0x18, 0x19, 0x1a, 0x25, 0x26, 0x27, 0x28,
      0x29, 0x2a, 0x34, 0x35, 0x36, 0x37, 0x38, 0x39,
      0x3a, 0x43, 0x44, 0x45, 0x46, 0x47, 0x48, 0x49,
      0x4a, 0x53, 0x54, 0x55, 0x56, 0x57, 0x58, 0x59,
      0x5a, 0x63, 0x64, 0x65, 0x66, 0x67, 0x68, 0x69,
      0x6a, 0x73, 0x74, 0x75, 0x76, 0x77, 0x78, 0x79,
      0x7a, 0x83, 0x84, 0x85, 0x86, 0x87, 0x88, 0x89,
      0x8a, 0x92, 0x93, 0x94, 0x95, 0x96, 0x97, 0x98,
      0x99, 0x9a, 0xa2, 0xa3, 0xa4, 0xa5, 0xa6, 0xa7,
      0xa8, 0xa9, 0xaa, 0xb2, 0xb3, 0xb4, 0xb5, 0xb6,
      0xb7, 0xb8, 0xb9, 0xba, 0xc2, 0xc3, 0xc4, 0xc5,
      0xc6, 0xc7, 0xc8, 0xc9, 0xca, 0xd2, 0xd3, 0xd4,
      0xd5, 0xd6, 0xd7, 0xd8, 0xd9, 0xda, 0xe1, 0xe2,
      0xe3, 0xe4, 0xe5, 0xe6, 0xe7, 0xe8, 0xe9, 0xea,
      0xf1, 0xf2, 0xf3, 0xf4, 0xf5, 0xf6, 0xf7, 0xf8,
      0xf9, 0xfa ]

bits_ac_chrominance = [ 0, 0, 2, 1, 2, 4, 4, 3, 4, 7, 5, 4, 4, 0, 1, 2, 0x77]
val_ac_chrominance = [ 0x00, 0x01, 0x02, 0x03, 0x11, 0x04, 0x05, 0x21,
      0x31, 0x06, 0x12, 0x41, 0x51, 0x07, 0x61, 0x71,
      0x13, 0x22, 0x32, 0x81, 0x08, 0x14, 0x42, 0x91,
      0xa1, 0xb1, 0xc1, 0x09, 0x23, 0x33, 0x52, 0xf0,
      0x15, 0x62, 0x72, 0xd1, 0x0a, 0x16, 0x24, 0x34,
      0xe1, 0x25, 0xf1, 0x17, 0x18, 0x19, 0x1a, 0x26,
      0x27, 0x28, 0x29, 0x2a, 0x35, 0x36, 0x37, 0x38,
      0x39, 0x3a, 0x43, 0x44, 0x45, 0x46, 0x47, 0x48,
      0x49, 0x4a, 0x53, 0x54, 0x55, 0x56, 0x57, 0x58,
      0x59, 0x5a, 0x63, 0x64, 0x65, 0x66, 0x67, 0x68,
      0x69, 0x6a, 0x73, 0x74, 0x75, 0x76, 0x77, 0x78,
      0x79, 0x7a, 0x82, 0x83, 0x84, 0x85, 0x86, 0x87,
      0x88, 0x89, 0x8a, 0x92, 0x93, 0x94, 0x95, 0x96,
      0x97, 0x98, 0x99, 0x9a, 0xa2, 0xa3, 0xa4, 0xa5,
      0xa6, 0xa7, 0xa8, 0xa9, 0xaa, 0xb2, 0xb3, 0xb4,
      0xb5, 0xb6, 0xb7, 0xb8, 0xb9, 0xba, 0xc2, 0xc3,
      0xc4, 0xc5, 0xc6, 0xc7, 0xc8, 0xc9, 0xca, 0xd2,
      0xd3, 0xd4, 0xd5, 0xd6, 0xd7, 0xd8, 0xd9, 0xda,
      0xe2, 0xe3, 0xe4, 0xe5, 0xe6, 0xe7, 0xe8, 0xe9,
      0xea, 0xf2, 0xf3, 0xf4, 0xf5, 0xf6, 0xf7, 0xf8,
      0xf9, 0xfa ]
      
bits_dc_luminance = [2,3,3,3,3,3,4,5,6,7,8,9]
bits_dc_chrominance = [2,2,2,3,4,5,6,7,8,9,10,11]

avg_actual_coef_600_0 = {0 : 251 , 1 : 150 , 2 : 147 , 3 : 85 , 4 : 94 , 5 : 136 , 6 : 67 , 7 : 58 , 8 : 61 , 9 : 63 , 10 : 45 , 11 : 41 , 12 : 42 , 13 : 31 , 14 : 36 , 15 : 16 , 16 : 25 , 17 : 24 , 18 : 24 , 19 : 23 , 20 : 24 , 21 : 11 , 22 : 10 , 23 : 12 , 24 : 17 , 25 : 12 , 26 : 7 , 27 : 10 , 28 : 10 , 29 : 5 , 30 : 7 , 31 : 8 , 32 : 8 , 33 : 7 , 34 : 5 , 35 : 8 , 36 : 4 , 37 : 4 , 38 : 5 , 39 : 6 , 40 : 5 , 41 : 4 , 42 : 6 , 43 : 8 , 44 : 4 , 45 : 3 , 46 : 3 , 47 : 4 , 48 : 3 , 49 : 3 , 50 : 2 , 51 : 2 , 52 : 2 , 53 : 6 , 54 : 3 , 55 : 1 , 56 : 2 , 57 : 3 , 58 : 2 , 59 : 1 , 60 : 2 , 61 : 2 , 62 : 2 , 63 : 2}

avg_actual_coef_600_1 = {1 : 40 , 2 : 42 , 3 : 23 , 4 : 20 , 5 : 20 , 6 : 6 , 7 : 11 , 8 : 13 , 9 : 8 , 10 : 2 , 11 : 3 , 12 : 5 , 13 : 4 , 14 : 3 , 15 : 2 , 16 : 2 , 17 : 2 , 18 : 2 , 19 : 2 , 20 : 2 , 21 : 1 , 22 : 1 , 23 : 1 , 24 : 1 , 25 : 2 , 26 : 1 , 27 : 1 , 28 : 1 , 29 : 1 , 30 : 1 , 31 : 1 , 32 : 1 , 33 : 1 , 34 : 1 , 35 : 1 , 36 : 1 , 37 : 1 , 38 : 1 , 39 : 1 , 40 : 1 , 41 : 1 , 42 : 1 , 43 : 1 , 44 : 1 , 45 : 1 , 46 : 1 , 47 : 1 , 48 : 1 , 49 : 1 , 50 : 1 , 51 : 1 , 52 : 1 , 53 : 1 , 54 : 1 , 55 : 1 , 56 : 1 , 57 : 1 , 58 : 1 , 59 : 0 , 60 : 1 , 61 : 0 , 62 : 1 , 63 : 1}

avg_coef_600_0 = {1 : 8 , 2 : 8 , 3 : 7 , 4 : 7 , 5 : 8 , 6 : 7 , 7 : 6 , 8 : 6 , 9 : 6 , 10 : 6 , 11 : 6 , 12 : 6 , 13 : 5 , 14 : 6 , 15 : 5 , 16 : 5 , 17 : 5 , 18 : 5 , 19 : 5 , 20 : 5 , 21 : 4 , 22 : 4 , 23 : 4 , 24 : 5 , 25 : 4 , 26 : 4 , 27 : 4 , 28 : 4 , 29 : 3 , 30 : 3 , 31 : 4 , 32 : 4 , 33 : 3 , 34 : 3 , 35 : 4 , 36 : 3 , 37 : 3 , 38 : 3 , 39 : 3 , 40 : 3 , 41 : 3 , 42 : 3 , 43 : 4 , 44 : 3 , 45 : 3 , 46 : 3 , 47 : 3 , 48 : 3 , 49 : 3 , 50 : 3 , 51 : 3 , 52 : 3 , 53 : 3 , 54 : 2 , 55 : 2 , 56 : 2 , 57 : 2 , 58 : 2 , 59 : 2 , 60 : 2 , 61 : 2 , 62 : 2 , 63 : 2}

avg_coef_600_1 = {1 : 6 , 2 : 6 , 3 : 5 , 4 : 5 , 5 : 5 , 6 : 4 , 7 : 4 , 8 : 4 , 9 : 4 , 10 : 3 , 11 : 3 , 12 : 3 , 13 : 3 , 14 : 2 , 15 : 2 , 16 : 2 , 17 : 2 , 18 : 2 , 19 : 2 , 20 : 2 , 21 : 1 , 22 : 1 , 23 : 1 , 24 : 1 , 25 : 2 , 26 : 1 , 27 : 1 , 28 : 1 , 29 : 1 , 30 : 1 , 31 : 1 , 32 : 1 , 33 : 1 , 34 : 1 , 35 : 1 , 36 : 1 , 37 : 1 , 38 : 1 , 39 : 1 , 40 : 1 , 41 : 1 , 42 : 1 , 43 : 1 , 44 : 1 , 45 : 1 , 46 : 1 , 47 : 1 , 48 : 1 , 49 : 1 , 50 : 1 , 51 : 1 , 52 : 1 , 53 : 1 , 54 : 1 , 55 : 1 , 56 : 1 , 57 : 1 , 58 : 1 , 59 : 1 , 60 : 1 , 61 : 1 , 62 : 1 , 63 : 1}

avg_coef_1200_0 = {1 : 8 , 2 : 8 , 3 : 7 , 4 : 8 , 5 : 8 , 6 : 7 , 7 : 6 , 8 : 7 , 9 : 7 , 10 : 6 , 11 : 6 , 12 : 6 , 13 : 6 , 14 : 6 , 15 : 5 , 16 : 5 , 17 : 5 , 18 : 5 , 19 : 5 , 20 : 6 , 21 : 4 , 22 : 4 , 23 : 4 , 24 : 4 , 25 : 5 , 26 : 4 , 27 : 4 , 28 : 4 , 29 : 3 , 30 : 3 , 31 : 3 , 32 : 3 , 33 : 4 , 34 : 3 , 35 : 3 , 36 : 3 , 37 : 3 , 38 : 3 , 39 : 3 , 40 : 3 , 41 : 3 , 42 : 3 , 43 : 3 , 44 : 3 , 45 : 2 , 46 : 2 , 47 : 2 , 48 : 2 , 49 : 2 , 50 : 2 , 51 : 2 , 52 : 2 , 53 : 2 , 54 : 2 , 55 : 2 , 56 : 2 , 57 : 2 , 58 : 2 , 59 : 2 , 60 : 2 , 61 : 1 , 62 : 1 , 63 : 1}

avg_coef_1200_1 = {1 : 6 , 2 : 6 , 3 : 5 , 4 : 5 , 5 : 5 , 6 : 4 , 7 : 4 , 8 : 4 , 9 : 3 , 10 : 3 , 11 : 3 , 12 : 3 , 13 : 2 , 14 : 2 , 15 : 2 , 16 : 2 , 17 : 2 , 18 : 2 , 19 : 2 , 20 : 2 , 21 : 1 , 22 : 1 , 23 : 2 , 24 : 1 , 25 : 1 , 26 : 1 , 27 : 1 , 28 : 1 , 29 : 1 , 30 : 1 , 31 : 1 , 32 : 1 , 33 : 1 , 34 : 1 , 35 : 1 , 36 : 1 , 37 : 1 , 38 : 1 , 39 : 1 , 40 : 1 , 41 : 1 , 42 : 1 , 43 : 1 , 44 : 1 , 45 : 1 , 46 : 1 , 47 : 1 , 48 : 1 , 49 : 1 , 50 : 1 , 51 : 1 , 52 : 1 , 53 : 1 , 54 : 1 , 55 : 1 , 56 : 1 , 57 : 1 , 58 : 1 , 59 : 1 , 60 : 1 , 61 : 1 , 62 : 1 , 63 : 1}
#apc_bins_600_0 = {1: [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.1, 0.1, 0.1, 0.2, 0.2, 0.3, 0.3, 0.3, 0.4, 0.4, 0.4, 0.5, 0.5, 0.6, 0.6, 0.7], 2: [0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.125, 0.25, 0.25, 0.25, 0.25, 0.375, 0.375, 0.375, 0.375, 0.5, 0.5, 0.5, 0.625, 0.625, 0.625, 0.75], 3: [0.062, 0.062, 0.062, 0.062, 0.062, 0.062, 0.062, 0.062, 0.062, 0.125, 0.125, 0.187, 0.187, 0.25, 0.25, 0.312, 0.312, 0.375, 0.375, 0.437, 0.437, 0.5, 0.5, 0.562, 0.562, 0.625, 0.687], 4: [0.043, 0.086, 0.086, 0.13, 0.13, 0.13, 0.13, 0.13, 0.173, 0.173, 0.217, 0.217, 0.26, 0.304, 0.304, 0.347, 0.347, 0.391, 0.391, 0.434, 0.434, 0.478, 0.478, 0.521, 0.565, 0.608, 0.652], 5: [0.066, 0.066, 0.1, 0.1, 0.1, 0.133, 0.133, 0.133, 0.133, 0.166, 0.2, 0.233, 0.233, 0.266, 0.3, 0.333, 0.333, 0.366, 0.4, 0.4, 0.433, 0.466, 0.5, 0.5, 0.533, 0.566, 0.633], 6: [0.052, 0.052, 0.078, 0.078, 0.105, 0.105, 0.105, 0.131, 0.131, 0.131, 0.184, 0.21, 0.236, 0.263, 0.289, 0.315, 0.342, 0.342, 0.368, 0.394, 0.421, 0.447, 0.473, 0.5, 0.526, 0.552, 0.605], 7: [0.088, 0.111, 0.111, 0.133, 0.155, 0.155, 0.155, 0.177, 0.177, 0.177, 0.222, 0.244, 0.266, 0.288, 0.311, 0.333, 0.355, 0.377, 0.4, 0.4, 0.422, 0.444, 0.466, 0.488, 0.511, 0.533, 0.577], 8: [0.058, 0.078, 0.098, 0.117, 0.117, 0.137, 0.137, 0.156, 0.156, 0.176, 0.196, 0.235, 0.254, 0.274, 0.294, 0.313, 0.333, 0.352, 0.372, 0.392, 0.411, 0.431, 0.45, 0.47, 0.509, 0.529, 0.568], 9: [0.052, 0.07, 0.087, 0.105, 0.105, 0.122, 0.14, 0.14, 0.14, 0.157, 0.192, 0.21, 0.245, 0.263, 0.28, 0.298, 0.333, 0.35, 0.368, 0.385, 0.403, 0.421, 0.456, 0.473, 0.491, 0.526, 0.578], 10: [0.047, 0.063, 0.079, 0.095, 0.095, 0.111, 0.126, 0.126, 0.142, 0.142, 0.174, 0.206, 0.238, 0.253, 0.269, 0.301, 0.317, 0.333, 0.365, 0.38, 0.396, 0.412, 0.444, 0.46, 0.492, 0.523, 0.555], 11: [0.072, 0.101, 0.115, 0.13, 0.13, 0.144, 0.159, 0.159, 0.173, 0.173, 0.202, 0.231, 0.26, 0.275, 0.304, 0.318, 0.333, 0.347, 0.376, 0.391, 0.405, 0.42, 0.449, 0.463, 0.492, 0.521, 0.55], 12: [0.08, 0.093, 0.12, 0.12, 0.133, 0.146, 0.16, 0.16, 0.173, 0.173, 0.213, 0.226, 0.253, 0.28, 0.293, 0.306, 0.333, 0.346, 0.36, 0.386, 0.4, 0.413, 0.44, 0.453, 0.48, 0.506, 0.546], 13: [0.074, 0.086, 0.098, 0.111, 0.123, 0.135, 0.148, 0.148, 0.16, 0.16, 0.197, 0.222, 0.246, 0.259, 0.283, 0.308, 0.32, 0.333, 0.358, 0.37, 0.395, 0.407, 0.432, 0.444, 0.469, 0.493, 0.53], 14: [0.081, 0.104, 0.127, 0.139, 0.139, 0.151, 0.162, 0.174, 0.174, 0.186, 0.209, 0.232, 0.255, 0.279, 0.29, 0.313, 0.325, 0.348, 0.36, 0.383, 0.395, 0.418, 0.43, 0.453, 0.476, 0.5, 0.534], 15: [0.086, 0.108, 0.13, 0.141, 0.152, 0.163, 0.163, 0.173, 0.184, 0.184, 0.217, 0.239, 0.26, 0.282, 0.293, 0.315, 0.326, 0.347, 0.358, 0.369, 0.391, 0.413, 0.423, 0.445, 0.467, 0.489, 0.521], 16: [0.123, 0.144, 0.164, 0.175, 0.185, 0.195, 0.206, 0.206, 0.216, 0.216, 0.247, 0.268, 0.288, 0.298, 0.319, 0.329, 0.35, 0.36, 0.371, 0.391, 0.402, 0.422, 0.432, 0.453, 0.474, 0.494, 0.525], 17: [0.107, 0.127, 0.147, 0.156, 0.166, 0.176, 0.176, 0.186, 0.196, 0.196, 0.225, 0.245, 0.264, 0.284, 0.294, 0.313, 0.323, 0.343, 0.352, 0.372, 0.382, 0.401, 0.411, 0.431, 0.45, 0.47, 0.509], 18: [0.093, 0.112, 0.13, 0.14, 0.149, 0.158, 0.168, 0.168, 0.177, 0.186, 0.205, 0.233, 0.252, 0.271, 0.289, 0.299, 0.317, 0.327, 0.345, 0.355, 0.373, 0.392, 0.401, 0.42, 0.439, 0.467, 0.495], 19: [0.08, 0.098, 0.116, 0.125, 0.133, 0.142, 0.151, 0.16, 0.16, 0.169, 0.196, 0.214, 0.241, 0.258, 0.276, 0.285, 0.303, 0.321, 0.33, 0.348, 0.366, 0.383, 0.392, 0.41, 0.437, 0.455, 0.491], 20: [0.076, 0.094, 0.111, 0.119, 0.128, 0.136, 0.145, 0.153, 0.153, 0.162, 0.188, 0.213, 0.23, 0.247, 0.264, 0.282, 0.299, 0.316, 0.324, 0.341, 0.358, 0.376, 0.393, 0.41, 0.427, 0.452, 0.487], 21: [0.073, 0.09, 0.106, 0.114, 0.122, 0.131, 0.139, 0.147, 0.155, 0.155, 0.18, 0.204, 0.221, 0.245, 0.262, 0.278, 0.295, 0.311, 0.327, 0.336, 0.352, 0.368, 0.385, 0.409, 0.426, 0.45, 0.483], 22: [0.111, 0.134, 0.15, 0.158, 0.166, 0.174, 0.182, 0.182, 0.19, 0.198, 0.222, 0.238, 0.261, 0.277, 0.293, 0.309, 0.325, 0.341, 0.349, 0.365, 0.38, 0.396, 0.412, 0.428, 0.444, 0.468, 0.492], 23: [0.115, 0.138, 0.146, 0.161, 0.169, 0.176, 0.184, 0.192, 0.2, 0.2, 0.223, 0.246, 0.261, 0.276, 0.292, 0.307, 0.315, 0.33, 0.346, 0.353, 0.369, 0.384, 0.4, 0.415, 0.43, 0.453, 0.476], 24: [0.119, 0.141, 0.156, 0.164, 0.171, 0.179, 0.186, 0.194, 0.201, 0.208, 0.231, 0.246, 0.261, 0.276, 0.291, 0.305, 0.32, 0.328, 0.343, 0.358, 0.365, 0.38, 0.395, 0.41, 0.425, 0.447, 0.47], 25: [0.1, 0.122, 0.129, 0.143, 0.151, 0.158, 0.165, 0.172, 0.179, 0.187, 0.208, 0.23, 0.244, 0.258, 0.273, 0.287, 0.302, 0.316, 0.323, 0.338, 0.352, 0.366, 0.381, 0.395, 0.41, 0.431, 0.46], 26: [0.125, 0.139, 0.153, 0.167, 0.174, 0.181, 0.188, 0.195, 0.202, 0.202, 0.23, 0.244, 0.258, 0.272, 0.286, 0.3, 0.314, 0.321, 0.335, 0.349, 0.363, 0.37, 0.384, 0.398, 0.419, 0.44, 0.468], 27: [0.142, 0.163, 0.176, 0.183, 0.197, 0.204, 0.21, 0.21, 0.217, 0.224, 0.244, 0.258, 0.272, 0.285, 0.299, 0.312, 0.326, 0.333, 0.346, 0.36, 0.367, 0.38, 0.394, 0.408, 0.421, 0.442, 0.469], 28: [0.099, 0.119, 0.132, 0.139, 0.145, 0.152, 0.158, 0.165, 0.172, 0.178, 0.198, 0.218, 0.238, 0.258, 0.271, 0.284, 0.298, 0.311, 0.324, 0.337, 0.35, 0.364, 0.377, 0.397, 0.41, 0.43, 0.456], 29: [0.109, 0.122, 0.135, 0.148, 0.154, 0.161, 0.167, 0.174, 0.174, 0.18, 0.206, 0.225, 0.245, 0.258, 0.277, 0.29, 0.303, 0.316, 0.329, 0.341, 0.354, 0.367, 0.38, 0.4, 0.412, 0.432, 0.458], 30: [0.145, 0.164, 0.177, 0.189, 0.196, 0.202, 0.208, 0.215, 0.221, 0.221, 0.246, 0.259, 0.272, 0.284, 0.297, 0.31, 0.322, 0.329, 0.341, 0.354, 0.364, 0.373, 0.386, 0.398, 0.417, 0.436, 0.455], 31: [0.149, 0.167, 0.18, 0.192, 0.198, 0.204, 0.211, 0.217, 0.223, 0.223, 0.242, 0.26, 0.273, 0.285, 0.298, 0.304, 0.316, 0.329, 0.335, 0.347, 0.36, 0.372, 0.378, 0.391, 0.409, 0.428, 0.453], 32: [0.133, 0.151, 0.169, 0.175, 0.181, 0.187, 0.193, 0.2, 0.206, 0.212, 0.23, 0.248, 0.26, 0.272, 0.284, 0.296, 0.303, 0.315, 0.327, 0.333, 0.345, 0.357, 0.369, 0.381, 0.393, 0.412, 0.442], 33: [0.136, 0.153, 0.165, 0.177, 0.183, 0.189, 0.195, 0.201, 0.207, 0.213, 0.23, 0.248, 0.26, 0.272, 0.284, 0.289, 0.301, 0.313, 0.325, 0.331, 0.343, 0.355, 0.366, 0.378, 0.39, 0.408, 0.437], 34: [0.127, 0.145, 0.156, 0.168, 0.174, 0.18, 0.186, 0.191, 0.197, 0.203, 0.22, 0.238, 0.25, 0.267, 0.279, 0.284, 0.296, 0.308, 0.319, 0.325, 0.337, 0.348, 0.36, 0.372, 0.389, 0.406, 0.43], 35: [0.12, 0.137, 0.148, 0.16, 0.165, 0.177, 0.182, 0.188, 0.194, 0.194, 0.217, 0.234, 0.251, 0.262, 0.274, 0.285, 0.297, 0.308, 0.32, 0.331, 0.337, 0.348, 0.365, 0.377, 0.388, 0.405, 0.434], 36: [0.089, 0.106, 0.117, 0.122, 0.128, 0.134, 0.139, 0.145, 0.145, 0.15, 0.167, 0.189, 0.206, 0.223, 0.24, 0.256, 0.273, 0.284, 0.301, 0.312, 0.324, 0.34, 0.351, 0.368, 0.379, 0.402, 0.424], 37: [0.115, 0.137, 0.148, 0.159, 0.17, 0.175, 0.186, 0.192, 0.197, 0.203, 0.225, 0.241, 0.258, 0.269, 0.28, 0.291, 0.302, 0.313, 0.324, 0.335, 0.346, 0.357, 0.368, 0.379, 0.395, 0.412, 0.434], 38: [0.14, 0.162, 0.178, 0.183, 0.194, 0.2, 0.205, 0.21, 0.216, 0.221, 0.237, 0.254, 0.264, 0.275, 0.286, 0.291, 0.302, 0.313, 0.324, 0.329, 0.34, 0.351, 0.362, 0.372, 0.383, 0.4, 0.427], 39: [0.138, 0.154, 0.17, 0.175, 0.186, 0.191, 0.196, 0.202, 0.207, 0.212, 0.228, 0.244, 0.255, 0.265, 0.276, 0.287, 0.297, 0.303, 0.313, 0.324, 0.329, 0.34, 0.351, 0.361, 0.377, 0.393, 0.414], 40: [0.141, 0.162, 0.172, 0.183, 0.188, 0.193, 0.198, 0.204, 0.209, 0.214, 0.23, 0.246, 0.256, 0.267, 0.277, 0.287, 0.298, 0.303, 0.314, 0.324, 0.335, 0.34, 0.35, 0.361, 0.376, 0.392, 0.413], 41: [0.149, 0.17, 0.18, 0.19, 0.195, 0.201, 0.208, 0.216, 0.221, 0.221, 0.242, 0.252, 0.268, 0.278, 0.288, 0.298, 0.304, 0.314, 0.324, 0.329, 0.34, 0.35, 0.36, 0.371, 0.381, 0.396, 0.417], 42: [0.137, 0.152, 0.162, 0.172, 0.177, 0.187, 0.192, 0.197, 0.203, 0.208, 0.223, 0.238, 0.248, 0.258, 0.269, 0.279, 0.289, 0.299, 0.309, 0.319, 0.324, 0.335, 0.35, 0.36, 0.37, 0.385, 0.411], 43: [0.115, 0.13, 0.14, 0.15, 0.16, 0.165, 0.17, 0.175, 0.18, 0.185, 0.2, 0.215, 0.23, 0.24, 0.255, 0.265, 0.275, 0.285, 0.295, 0.305, 0.315, 0.325, 0.34, 0.35, 0.365, 0.38, 0.405], 44: [0.132, 0.147, 0.156, 0.166, 0.176, 0.181, 0.186, 0.191, 0.196, 0.2, 0.215, 0.23, 0.24, 0.254, 0.264, 0.274, 0.284, 0.294, 0.299, 0.308, 0.318, 0.328, 0.338, 0.352, 0.362, 0.382, 0.401], 45: [0.154, 0.173, 0.183, 0.188, 0.198, 0.202, 0.207, 0.212, 0.217, 0.222, 0.236, 0.246, 0.26, 0.27, 0.28, 0.289, 0.294, 0.304, 0.314, 0.323, 0.328, 0.338, 0.347, 0.357, 0.371, 0.386, 0.405], 46: [0.166, 0.185, 0.195, 0.207, 0.214, 0.219, 0.223, 0.228, 0.233, 0.238, 0.252, 0.266, 0.276, 0.285, 0.295, 0.304, 0.309, 0.319, 0.323, 0.333, 0.342, 0.347, 0.357, 0.366, 0.38, 0.39, 0.409], 47: [0.15, 0.164, 0.173, 0.183, 0.187, 0.197, 0.201, 0.206, 0.211, 0.211, 0.23, 0.244, 0.253, 0.262, 0.272, 0.281, 0.291, 0.295, 0.305, 0.314, 0.323, 0.328, 0.342, 0.352, 0.361, 0.375, 0.399], 48: [0.138, 0.157, 0.166, 0.175, 0.185, 0.189, 0.194, 0.199, 0.203, 0.208, 0.222, 0.236, 0.25, 0.259, 0.268, 0.273, 0.282, 0.291, 0.296, 0.305, 0.314, 0.324, 0.333, 0.342, 0.356, 0.375, 0.393], 49: [0.114, 0.141, 0.155, 0.164, 0.168, 0.178, 0.182, 0.187, 0.191, 0.196, 0.214, 0.228, 0.237, 0.251, 0.26, 0.264, 0.273, 0.283, 0.292, 0.301, 0.31, 0.319, 0.328, 0.342, 0.351, 0.369, 0.388], 50: [0.144, 0.162, 0.171, 0.175, 0.184, 0.189, 0.193, 0.198, 0.202, 0.207, 0.225, 0.238, 0.247, 0.261, 0.27, 0.274, 0.283, 0.292, 0.297, 0.306, 0.315, 0.324, 0.333, 0.342, 0.355, 0.369, 0.387], 51: [0.155, 0.173, 0.182, 0.191, 0.195, 0.204, 0.208, 0.208, 0.213, 0.217, 0.235, 0.244, 0.257, 0.266, 0.275, 0.284, 0.288, 0.297, 0.306, 0.311, 0.32, 0.328, 0.337, 0.346, 0.355, 0.368, 0.389], 52: [0.162, 0.175, 0.184, 0.188, 0.197, 0.201, 0.206, 0.21, 0.214, 0.219, 0.232, 0.245, 0.254, 0.267, 0.276, 0.285, 0.293, 0.298, 0.307, 0.315, 0.322, 0.328, 0.337, 0.346, 0.359, 0.372, 0.385], 53: [0.134, 0.151, 0.168, 0.177, 0.186, 0.194, 0.199, 0.203, 0.207, 0.212, 0.225, 0.238, 0.251, 0.259, 0.268, 0.277, 0.285, 0.294, 0.298, 0.307, 0.316, 0.324, 0.333, 0.341, 0.354, 0.363, 0.38], 54: [0.128, 0.145, 0.153, 0.162, 0.166, 0.17, 0.175, 0.179, 0.183, 0.188, 0.205, 0.217, 0.226, 0.235, 0.247, 0.256, 0.264, 0.269, 0.277, 0.286, 0.294, 0.303, 0.311, 0.324, 0.333, 0.35, 0.367], 55: [0.144, 0.156, 0.165, 0.173, 0.177, 0.182, 0.19, 0.194, 0.199, 0.203, 0.22, 0.228, 0.241, 0.25, 0.258, 0.266, 0.275, 0.283, 0.292, 0.3, 0.309, 0.313, 0.322, 0.334, 0.343, 0.355, 0.377], 56: [0.151, 0.163, 0.179, 0.184, 0.193, 0.197, 0.205, 0.21, 0.214, 0.214, 0.231, 0.243, 0.256, 0.264, 0.273, 0.281, 0.289, 0.298, 0.302, 0.31, 0.319, 0.323, 0.331, 0.34, 0.352, 0.369, 0.386], 57: [0.154, 0.17, 0.187, 0.195, 0.2, 0.204, 0.208, 0.212, 0.216, 0.22, 0.237, 0.245, 0.258, 0.266, 0.275, 0.283, 0.291, 0.295, 0.304, 0.312, 0.316, 0.325, 0.333, 0.341, 0.354, 0.366, 0.383], 58: [0.144, 0.157, 0.169, 0.177, 0.185, 0.19, 0.194, 0.198, 0.202, 0.206, 0.223, 0.235, 0.243, 0.252, 0.264, 0.268, 0.276, 0.28, 0.289, 0.297, 0.305, 0.314, 0.322, 0.33, 0.342, 0.355, 0.376], 59: [0.149, 0.159, 0.168, 0.18, 0.185, 0.192, 0.196, 0.2, 0.204, 0.209, 0.221, 0.233, 0.245, 0.254, 0.262, 0.27, 0.278, 0.286, 0.295, 0.302, 0.307, 0.315, 0.323, 0.331, 0.344, 0.356, 0.372], 60: [0.151, 0.166, 0.178, 0.184, 0.195, 0.199, 0.207, 0.211, 0.215, 0.215, 0.231, 0.243, 0.252, 0.264, 0.272, 0.28, 0.288, 0.292, 0.3, 0.304, 0.313, 0.321, 0.329, 0.341, 0.353, 0.365, 0.381], 61: [0.151, 0.161, 0.173, 0.181, 0.186, 0.193, 0.197, 0.2, 0.201, 0.205, 0.221, 0.233, 0.241, 0.25, 0.262, 0.27, 0.274, 0.282, 0.29, 0.298, 0.302, 0.31, 0.318, 0.33, 0.338, 0.35, 0.37], 62: [0.152, 0.168, 0.18, 0.184, 0.192, 0.2, 0.204, 0.208, 0.212, 0.212, 0.224, 0.236, 0.248, 0.256, 0.264, 0.272, 0.281, 0.292, 0.3, 0.304, 0.312, 0.32, 0.328, 0.336, 0.348, 0.36, 0.376], 63: [0.133, 0.153, 0.164, 0.174, 0.187, 0.194, 0.198, 0.202, 0.206, 0.21, 0.226, 0.238, 0.246, 0.253, 0.261, 0.269, 0.277, 0.285, 0.289, 0.297, 0.305, 0.313, 0.321, 0.329, 0.341, 0.353, 0.372]}

apc_bins_600_0 = {1: [0.0, 0.1, 0.1, 0.2, 0.3, 0.4, 0.4, 0.5, 0.6], 2: [0.125, 0.125, 0.25, 0.25, 0.375, 0.375, 0.5, 0.625, 0.625], 3: [0.125, 0.187, 0.25, 0.312, 0.375, 0.437, 0.5, 0.562, 0.625], 4: [0.173, 0.217, 0.304, 0.347, 0.391, 0.434, 0.478, 0.521, 0.608], 5: [0.166, 0.233, 0.266, 0.333, 0.366, 0.4, 0.466, 0.5, 0.566], 6: [0.131, 0.21, 0.263, 0.315, 0.342, 0.394, 0.447, 0.5, 0.552], 7: [0.177, 0.244, 0.288, 0.333, 0.377, 0.4, 0.444, 0.488, 0.533], 8: [0.176, 0.235, 0.274, 0.313, 0.352, 0.392, 0.431, 0.47, 0.529], 9: [0.157, 0.21, 0.263, 0.298, 0.35, 0.385, 0.421, 0.473, 0.526], 10: [0.142, 0.206, 0.253, 0.301, 0.333, 0.38, 0.412, 0.46, 0.523], 11: [0.173, 0.231, 0.275, 0.318, 0.347, 0.391, 0.42, 0.463, 0.521], 12: [0.173, 0.226, 0.28, 0.306, 0.346, 0.386, 0.413, 0.453, 0.506], 13: [0.16, 0.222, 0.259, 0.308, 0.333, 0.37, 0.407, 0.444, 0.493], 14: [0.186, 0.232, 0.279, 0.313, 0.348, 0.383, 0.418, 0.453, 0.5], 15: [0.184, 0.239, 0.282, 0.315, 0.347, 0.369, 0.413, 0.445, 0.489], 16: [0.216, 0.268, 0.298, 0.329, 0.36, 0.391, 0.422, 0.453, 0.494], 17: [0.196, 0.245, 0.284, 0.313, 0.343, 0.372, 0.401, 0.431, 0.47], 18: [0.186, 0.233, 0.271, 0.299, 0.327, 0.355, 0.392, 0.42, 0.467], 19: [0.169, 0.214, 0.258, 0.285, 0.321, 0.348, 0.383, 0.41, 0.455], 20: [0.162, 0.213, 0.247, 0.282, 0.316, 0.341, 0.376, 0.41, 0.452], 21: [0.155, 0.204, 0.245, 0.278, 0.311, 0.336, 0.368, 0.409, 0.45], 22: [0.198, 0.238, 0.277, 0.309, 0.341, 0.365, 0.396, 0.428, 0.468], 23: [0.2, 0.246, 0.276, 0.307, 0.33, 0.353, 0.384, 0.415, 0.453], 24: [0.208, 0.246, 0.276, 0.305, 0.328, 0.358, 0.38, 0.41, 0.447], 25: [0.187, 0.23, 0.258, 0.287, 0.316, 0.338, 0.366, 0.395, 0.431], 26: [0.202, 0.244, 0.272, 0.3, 0.321, 0.349, 0.37, 0.398, 0.44], 27: [0.224, 0.258, 0.285, 0.312, 0.333, 0.36, 0.38, 0.408, 0.442], 28: [0.178, 0.218, 0.258, 0.284, 0.311, 0.337, 0.364, 0.397, 0.43], 29: [0.18, 0.225, 0.258, 0.29, 0.316, 0.341, 0.367, 0.4, 0.432], 30: [0.221, 0.259, 0.284, 0.31, 0.329, 0.354, 0.373, 0.398, 0.436], 31: [0.223, 0.26, 0.285, 0.304, 0.329, 0.347, 0.372, 0.391, 0.428], 32: [0.212, 0.248, 0.272, 0.296, 0.315, 0.333, 0.357, 0.381, 0.412], 33: [0.213, 0.248, 0.272, 0.289, 0.313, 0.331, 0.355, 0.378, 0.408], 34: [0.203, 0.238, 0.267, 0.284, 0.308, 0.325, 0.348, 0.372, 0.406], 35: [0.194, 0.234, 0.262, 0.285, 0.308, 0.331, 0.348, 0.377, 0.405], 36: [0.15, 0.189, 0.223, 0.256, 0.284, 0.312, 0.34, 0.368, 0.402], 37: [0.203, 0.241, 0.269, 0.291, 0.313, 0.335, 0.357, 0.379, 0.412], 38: [0.221, 0.254, 0.275, 0.291, 0.313, 0.329, 0.351, 0.372, 0.4], 39: [0.212, 0.244, 0.265, 0.287, 0.303, 0.324, 0.34, 0.361, 0.393], 40: [0.214, 0.246, 0.267, 0.287, 0.303, 0.324, 0.34, 0.361, 0.392], 41: [0.221, 0.252, 0.278, 0.298, 0.314, 0.329, 0.35, 0.371, 0.396], 42: [0.208, 0.238, 0.258, 0.279, 0.299, 0.319, 0.335, 0.36, 0.385], 43: [0.185, 0.215, 0.24, 0.265, 0.285, 0.305, 0.325, 0.35, 0.38], 44: [0.2, 0.23, 0.254, 0.274, 0.294, 0.308, 0.328, 0.352, 0.382], 45: [0.222, 0.246, 0.27, 0.289, 0.304, 0.323, 0.338, 0.357, 0.386], 46: [0.238, 0.266, 0.285, 0.304, 0.319, 0.333, 0.347, 0.366, 0.39], 47: [0.211, 0.244, 0.262, 0.281, 0.295, 0.314, 0.328, 0.352, 0.375], 48: [0.208, 0.236, 0.259, 0.273, 0.291, 0.305, 0.324, 0.342, 0.375], 49: [0.196, 0.228, 0.251, 0.264, 0.283, 0.301, 0.319, 0.342, 0.369], 50: [0.207, 0.238, 0.261, 0.274, 0.292, 0.306, 0.324, 0.342, 0.369], 51: [0.217, 0.244, 0.266, 0.284, 0.297, 0.311, 0.328, 0.346, 0.368], 52: [0.219, 0.245, 0.267, 0.285, 0.298, 0.315, 0.328, 0.346, 0.372], 53: [0.212, 0.238, 0.259, 0.277, 0.294, 0.307, 0.324, 0.341, 0.363], 54: [0.188, 0.217, 0.235, 0.256, 0.269, 0.286, 0.303, 0.324, 0.35], 55: [0.203, 0.228, 0.25, 0.266, 0.283, 0.3, 0.313, 0.334, 0.355], 56: [0.214, 0.243, 0.264, 0.281, 0.298, 0.31, 0.323, 0.34, 0.369], 57: [0.22, 0.245, 0.266, 0.283, 0.295, 0.312, 0.325, 0.341, 0.366], 58: [0.206, 0.235, 0.252, 0.268, 0.28, 0.297, 0.314, 0.33, 0.355], 59: [0.209, 0.233, 0.254, 0.27, 0.286, 0.302, 0.315, 0.331, 0.356], 60: [0.215, 0.243, 0.264, 0.28, 0.292, 0.304, 0.321, 0.341, 0.365], 61: [0.205, 0.233, 0.25, 0.27, 0.282, 0.298, 0.31, 0.33, 0.35], 62: [0.212, 0.236, 0.256, 0.272, 0.292, 0.304, 0.32, 0.336, 0.36], 63: [0.21, 0.238, 0.253, 0.269, 0.285, 0.297, 0.313, 0.329, 0.353]}

apc_bins_600_1 = {1: [0.0, 0.0, 0.0, 0.1, 0.1, 0.2, 0.2, 0.3, 0.4], 2: [0.166, 0.166, 0.166, 0.166, 0.333, 0.333, 0.333, 0.5, 0.5], 3: [0.083, 0.083, 0.166, 0.166, 0.25, 0.25, 0.333, 0.416, 0.5], 4: [0.117, 0.176, 0.176, 0.235, 0.294, 0.294, 0.352, 0.411, 0.47], 5: [0.09, 0.136, 0.181, 0.227, 0.227, 0.272, 0.318, 0.363, 0.454], 6: [0.111, 0.148, 0.185, 0.185, 0.222, 0.259, 0.296, 0.37, 0.444], 7: [0.161, 0.193, 0.225, 0.258, 0.29, 0.322, 0.354, 0.387, 0.451], 8: [0.114, 0.142, 0.171, 0.2, 0.228, 0.257, 0.314, 0.342, 0.428], 9: [0.102, 0.128, 0.179, 0.205, 0.23, 0.256, 0.282, 0.333, 0.41], 10: [0.116, 0.162, 0.186, 0.209, 0.232, 0.279, 0.302, 0.348, 0.418], 11: [0.152, 0.195, 0.239, 0.282, 0.304, 0.347, 0.369, 0.413, 0.478], 12: [0.163, 0.204, 0.244, 0.265, 0.285, 0.326, 0.346, 0.387, 0.428], 13: [0.153, 0.192, 0.211, 0.23, 0.269, 0.288, 0.326, 0.346, 0.403], 14: [0.163, 0.2, 0.218, 0.254, 0.272, 0.29, 0.327, 0.363, 0.4], 15: [0.14, 0.175, 0.192, 0.228, 0.245, 0.263, 0.298, 0.333, 0.385], 16: [0.118, 0.169, 0.186, 0.203, 0.237, 0.254, 0.288, 0.322, 0.372], 17: [0.196, 0.229, 0.245, 0.278, 0.295, 0.311, 0.344, 0.377, 0.411], 18: [0.19, 0.222, 0.253, 0.285, 0.301, 0.333, 0.349, 0.38, 0.428], 19: [0.2, 0.23, 0.246, 0.276, 0.292, 0.323, 0.338, 0.369, 0.415], 20: [0.149, 0.208, 0.238, 0.253, 0.283, 0.298, 0.343, 0.358, 0.402], 21: [0.115, 0.144, 0.173, 0.202, 0.217, 0.26, 0.289, 0.318, 0.362], 22: [0.057, 0.1, 0.142, 0.174, 0.207, 0.242, 0.285, 0.328, 0.371], 23: [0.108, 0.154, 0.211, 0.253, 0.281, 0.295, 0.338, 0.366, 0.408], 24: [0.163, 0.194, 0.236, 0.263, 0.291, 0.305, 0.333, 0.361, 0.402], 25: [0.164, 0.2, 0.232, 0.26, 0.287, 0.312, 0.328, 0.356, 0.397], 26: [0.133, 0.173, 0.213, 0.24, 0.253, 0.28, 0.306, 0.346, 0.373], 27: [0.144, 0.171, 0.197, 0.223, 0.236, 0.263, 0.289, 0.315, 0.365], 28: [0.09, 0.129, 0.142, 0.155, 0.181, 0.194, 0.22, 0.246, 0.298], 29: [0.064, 0.089, 0.128, 0.153, 0.179, 0.192, 0.217, 0.241, 0.282], 30: [0.164, 0.202, 0.215, 0.24, 0.253, 0.265, 0.278, 0.303, 0.341], 31: [0.175, 0.2, 0.225, 0.25, 0.275, 0.287, 0.312, 0.34, 0.362], 32: [0.185, 0.209, 0.246, 0.271, 0.29, 0.308, 0.308, 0.345, 0.37], 33: [0.175, 0.207, 0.231, 0.256, 0.28, 0.304, 0.326, 0.341, 0.365], 34: [0.18, 0.212, 0.228, 0.265, 0.289, 0.301, 0.326, 0.349, 0.39], 35: [0.136, 0.154, 0.184, 0.202, 0.238, 0.273, 0.297, 0.297, 0.333], 36: [0.07, 0.072, 0.103, 0.129, 0.141, 0.164, 0.188, 0.223, 0.305], 37: [0.118, 0.165, 0.186, 0.197, 0.232, 0.251, 0.279, 0.29, 0.325], 38: [0.131, 0.165, 0.185, 0.216, 0.241, 0.275, 0.286, 0.333, 0.351], 39: [0.17, 0.204, 0.227, 0.261, 0.272, 0.295, 0.318, 0.329, 0.34], 40: [0.148, 0.179, 0.202, 0.224, 0.269, 0.294, 0.314, 0.332, 0.337], 41: [0.133, 0.155, 0.216, 0.244, 0.272, 0.277, 0.311, 0.333, 0.35], 42: [0.128, 0.164, 0.186, 0.206, 0.219, 0.257, 0.274, 0.296, 0.321], 43: [0.164, 0.176, 0.198, 0.217, 0.222, 0.245, 0.25, 0.25, 0.282], 44: [0.132, 0.163, 0.172, 0.18, 0.209, 0.232, 0.274, 0.324, 0.343], 45: [0.115, 0.185, 0.244, 0.261, 0.271, 0.276, 0.286, 0.297, 0.321], 46: [0.192, 0.21, 0.23, 0.254, 0.268, 0.273, 0.285, 0.294, 0.305], 47: [0.204, 0.214, 0.243, 0.262, 0.27, 0.289, 0.291, 0.31, 0.325], 48: [0.173, 0.187, 0.204, 0.216, 0.226, 0.243, 0.259, 0.284, 0.309], 49: [0.12, 0.13, 0.15, 0.169, 0.188, 0.204, 0.22, 0.234, 0.244], 50: [0.139, 0.165, 0.193, 0.22, 0.252, 0.26, 0.28, 0.301, 0.313], 51: [0.184, 0.194, 0.201, 0.208, 0.215, 0.224, 0.238, 0.258, 0.294], 52: [0.17, 0.211, 0.253, 0.271, 0.277, 0.283, 0.297, 0.326, 0.356], 53: [0.294, 0.294, 0.294, 0.296, 0.299, 0.301, 0.306, 0.315, 0.324], 54: [0.155, 0.165, 0.174, 0.184, 0.194, 0.217, 0.24, 0.264, 0.287], 55: [0.25, 0.25, 0.25, 0.25, 0.25, 0.25, 0.25, 0.25, 0.25], 56: [0.201, 0.213, 0.224, 0.236, 0.247, 0.257, 0.266, 0.276, 0.285], 57: [0.33, 0.33, 0.33, 0.33, 0.33, 0.33, 0.33, 0.33, 0.33], 58: [0.213, 0.22, 0.228, 0.235, 0.242, 0.25, 0.257, 0.265, 0.272], 59: [0.25, 0.25, 0.25, 0.25, 0.25, 0.25, 0.25, 0.25, 0.25], 60: [0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9], 61: [0.174, 0.176, 0.178, 0.18, 0.181, 0.183, 0.185, 0.187, 0.189], 62: [0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9], 63: [0.173, 0.185, 0.198, 0.21, 0.223, 0.235, 0.248, 0.26, 0.273]}

apc_bins_1200_0 = {1: [0.0, 0.0, 0.1, 0.2, 0.2, 0.3, 0.4, 0.5, 0.6], 2: [0.125, 0.125, 0.25, 0.25, 0.375, 0.375, 0.5, 0.5, 0.625], 3: [0.125, 0.125, 0.187, 0.25, 0.312, 0.375, 0.437, 0.5, 0.562], 4: [0.13, 0.173, 0.26, 0.304, 0.347, 0.391, 0.434, 0.478, 0.565], 5: [0.1, 0.166, 0.233, 0.266, 0.333, 0.366, 0.433, 0.466, 0.566], 6: [0.105, 0.157, 0.21, 0.263, 0.315, 0.342, 0.394, 0.447, 0.526], 7: [0.155, 0.2, 0.244, 0.288, 0.333, 0.377, 0.422, 0.466, 0.511], 8: [0.117, 0.176, 0.235, 0.274, 0.313, 0.352, 0.392, 0.45, 0.509], 9: [0.122, 0.175, 0.228, 0.263, 0.298, 0.35, 0.385, 0.438, 0.508], 10: [0.111, 0.158, 0.206, 0.253, 0.301, 0.333, 0.38, 0.428, 0.492], 11: [0.144, 0.202, 0.246, 0.289, 0.318, 0.362, 0.405, 0.434, 0.492], 12: [0.146, 0.2, 0.24, 0.28, 0.32, 0.346, 0.386, 0.426, 0.48], 13: [0.123, 0.185, 0.222, 0.259, 0.296, 0.333, 0.37, 0.419, 0.469], 14: [0.151, 0.197, 0.244, 0.279, 0.313, 0.348, 0.383, 0.43, 0.476], 15: [0.163, 0.206, 0.25, 0.282, 0.315, 0.347, 0.38, 0.423, 0.467], 16: [0.216, 0.257, 0.288, 0.319, 0.35, 0.381, 0.412, 0.443, 0.484], 17: [0.176, 0.225, 0.264, 0.294, 0.323, 0.352, 0.382, 0.411, 0.46], 18: [0.158, 0.205, 0.242, 0.271, 0.308, 0.336, 0.364, 0.401, 0.448], 19: [0.142, 0.187, 0.223, 0.258, 0.294, 0.321, 0.357, 0.392, 0.437], 20: [0.145, 0.188, 0.222, 0.256, 0.29, 0.316, 0.35, 0.384, 0.435], 21: [0.139, 0.188, 0.221, 0.254, 0.286, 0.319, 0.352, 0.385, 0.434], 22: [0.198, 0.238, 0.269, 0.301, 0.333, 0.365, 0.388, 0.42, 0.46], 23: [0.192, 0.238, 0.269, 0.292, 0.323, 0.346, 0.369, 0.4, 0.438], 24: [0.194, 0.238, 0.268, 0.291, 0.32, 0.343, 0.365, 0.395, 0.432], 25: [0.172, 0.208, 0.244, 0.266, 0.294, 0.323, 0.345, 0.381, 0.417], 26: [0.195, 0.23, 0.258, 0.286, 0.314, 0.335, 0.363, 0.391, 0.426], 27: [0.217, 0.258, 0.285, 0.312, 0.333, 0.353, 0.38, 0.401, 0.435], 28: [0.172, 0.211, 0.245, 0.278, 0.311, 0.337, 0.364, 0.39, 0.43], 29: [0.18, 0.219, 0.258, 0.29, 0.322, 0.348, 0.374, 0.4, 0.432], 30: [0.227, 0.265, 0.291, 0.316, 0.335, 0.354, 0.379, 0.398, 0.43], 31: [0.223, 0.26, 0.285, 0.304, 0.322, 0.347, 0.366, 0.391, 0.422], 32: [0.206, 0.242, 0.266, 0.29, 0.309, 0.327, 0.351, 0.375, 0.406], 33: [0.207, 0.242, 0.266, 0.289, 0.307, 0.325, 0.349, 0.372, 0.402], 34: [0.203, 0.238, 0.261, 0.284, 0.302, 0.319, 0.343, 0.366, 0.401], 35: [0.2, 0.234, 0.257, 0.28, 0.302, 0.325, 0.348, 0.371, 0.405], 36: [0.156, 0.184, 0.217, 0.245, 0.279, 0.307, 0.335, 0.363, 0.396], 37: [0.197, 0.236, 0.263, 0.285, 0.313, 0.335, 0.357, 0.379, 0.412], 38: [0.227, 0.259, 0.281, 0.297, 0.313, 0.335, 0.351, 0.372, 0.4], 39: [0.218, 0.244, 0.265, 0.287, 0.303, 0.319, 0.34, 0.361, 0.388], 40: [0.219, 0.246, 0.272, 0.287, 0.303, 0.324, 0.34, 0.361, 0.387], 41: [0.231, 0.257, 0.283, 0.298, 0.314, 0.329, 0.35, 0.371, 0.396], 42: [0.213, 0.243, 0.263, 0.284, 0.304, 0.319, 0.34, 0.36, 0.385], 43: [0.185, 0.22, 0.245, 0.27, 0.29, 0.31, 0.33, 0.35, 0.38], 44: [0.2, 0.235, 0.254, 0.274, 0.294, 0.313, 0.333, 0.352, 0.377], 45: [0.231, 0.256, 0.28, 0.294, 0.309, 0.323, 0.342, 0.362, 0.386], 46: [0.242, 0.271, 0.29, 0.304, 0.319, 0.333, 0.347, 0.366, 0.39], 47: [0.22, 0.248, 0.267, 0.286, 0.3, 0.314, 0.333, 0.347, 0.375], 48: [0.222, 0.245, 0.263, 0.282, 0.296, 0.31, 0.328, 0.347, 0.37], 49: [0.196, 0.228, 0.246, 0.264, 0.283, 0.301, 0.319, 0.337, 0.365], 50: [0.22, 0.243, 0.261, 0.279, 0.297, 0.31, 0.328, 0.346, 0.369], 51: [0.231, 0.257, 0.28, 0.293, 0.306, 0.32, 0.337, 0.351, 0.377], 52: [0.232, 0.258, 0.276, 0.293, 0.307, 0.32, 0.333, 0.35, 0.372], 53: [0.233, 0.259, 0.277, 0.29, 0.303, 0.316, 0.329, 0.346, 0.372], 54: [0.196, 0.222, 0.243, 0.26, 0.273, 0.29, 0.307, 0.324, 0.346], 55: [0.22, 0.245, 0.262, 0.279, 0.292, 0.305, 0.322, 0.334, 0.36], 56: [0.231, 0.26, 0.277, 0.294, 0.306, 0.319, 0.336, 0.352, 0.373], 57: [0.233, 0.258, 0.279, 0.295, 0.308, 0.325, 0.337, 0.35, 0.375], 58: [0.223, 0.247, 0.264, 0.28, 0.289, 0.305, 0.318, 0.338, 0.363], 59: [0.221, 0.25, 0.269, 0.282, 0.295, 0.311, 0.323, 0.34, 0.364], 60: [0.243, 0.264, 0.28, 0.292, 0.304, 0.317, 0.329, 0.345, 0.369], 61: [0.225, 0.25, 0.266, 0.278, 0.294, 0.306, 0.318, 0.334, 0.358], 62: [0.24, 0.264, 0.276, 0.292, 0.304, 0.316, 0.332, 0.352, 0.364], 63: [0.226, 0.257, 0.273, 0.289, 0.297, 0.313, 0.325, 0.341, 0.361]}






def generate_bits(vals, bits):
	ret = {}
	now = 0
	for b in range(len(bits)):
		t = bits[b]
		for i in range(t):
			ret[vals[now]] = b
			now += 1
	return ret	

def get_luminance_codes():
	return generate_bits(val_ac_luminance, bits_ac_luminance)

def get_chrominance_codes():
	return generate_bits(val_ac_chrominance, bits_ac_chrominance)

def get_jpeg_bits_with_dc(coefs, st, en, code, last_dc, luminance):
	dc_bits = get_bits(abs(coefs[0]-last_dc))
	if luminance:
		dc_s_bits = bits_dc_luminance[dc_bits]
	else:
		dc_s_bits = bits_dc_chrominance[dc_bits]
	return dc_bits + dc_s_bits + get_jpeg_bits(coefs, st + 1, en, code, False)[0], coefs[0]
	
def get_jpeg_bits_with_dc_detail(coefs, st, en, code, last_dc, luminance):
	dc_bits = get_bits(abs(coefs[0]-last_dc))
	if luminance:
		dc_s_bits = bits_dc_luminance[dc_bits]
	else:
		dc_s_bits = bits_dc_chrominance[dc_bits]
	ret = get_jpeg_bits(coefs, st + 1, en, code, False)
	return dc_bits + dc_s_bits + ret[0], coefs[0], dc_s_bits, dc_bits, ret[0] - ret[1], ret[1]
	
def get_jpeg_bits_detail(coefs, st, en, code, luminance):
	dc_bits = coefs[0]
	if luminance:
		dc_s_bits = bits_dc_luminance[dc_bits]
	else:
		dc_s_bits = bits_dc_chrominance[dc_bits]
	ret = get_jpeg_bits(coefs, st + 1, en, code, False)
	return dc_bits + dc_s_bits + ret[0], dc_s_bits, dc_bits, ret[0] - ret[1], ret[1]

def print_prefix(pre_n, pre):
	for i in range(pre_n):
		print pre[i],

def print_prefix_to_file(pre_n, pre, f):
	for i in range(pre_n-1):
		f.write(str(pre[i]) + " ")	
	f.write(str(pre[pre_n-1]))

#get total bits for one block
def get_total_bits(i, code, last_dc, comp):
	return get_jpeg_bits_with_dc(i, 0, len(i)-1, code, last_dc, comp)

def get_total_bits_detail(i, code, last_dc, comp):
	return get_jpeg_bits_with_dc_detail(i, 0, len(i)-1, code, last_dc, comp)
	
def get_bits_detail(i, code, comp):
	return get_jpeg_bits_detail(i, 0, len(i)-1, code, comp)

#get run-length bits only for one block (does not include DC bits, and actual coefficient)
def get_run_length_bits(i, code):
	return get_jpeg_bits(i, 1, len(i)-1, code, True)[0]

def get_run_length_bits_detail(i, code):
	return get_jpeg_bits(i, 1, len(i)-1, code, True)

# if COEFS is ended with a -1, that means the prefix is all 0 afterwards till the end of block, it also means n is 63
def get_jpeg_bits(coefs, st, en, code, run_length_only):
	b = 0
	r = 0
	coef_bits = 0
	for i in range(st, en + 1):
		if coefs[i] == 0:
			r += 1
			continue
	
		while (r > 15):
			b += code[0xf0]
			r -= 16
	
		b += code[(r << 4) + coefs[i]]
		if not run_length_only:
			b += coefs[i]
			coef_bits += coefs[i]
		r = 0
	if (st == 1):
		if (en == 63 and r > 0):
			b += code[0]
	else:
		if (en == 62 and r > 0):
			b += code[0]
#	print_prefix(en + 1, coefs)
#	print b
	return b, coef_bits
	

def get_blocks(filename, comp):
	ff = filename.split("|")
	blocks = []
	for f in ff:
		t_blocks = open(f).readlines()
		last_dc = 0
		for i in range(len(t_blocks)):
			s = t_blocks[i][:-2].split(" ")
			ii = []
			if s[0] == comp + ":":
				for j in range(1, len(s)):
					ii.append(int(s[j]))
				blocks.append(ii)
	return blocks
	
def get_blocks_with_dc_in_diff(filename, comp):   # the first DC coef will be the difference
	ff = filename.split("|")
	blocks = []
	for f in ff:
		t_blocks = open(f).readlines()
		last_dc = 0
		for i in range(len(t_blocks)):
			s = t_blocks[i][:-2].split(" ")
			ii = []
			if s[0] == comp + ":":
				for j in range(1, len(s)):
					if j==1:
						ii.append(int(s[j]) - last_dc)
						last_dc = int(s[j])
					else:
						ii.append(int(s[j]))
				blocks.append(ii)
	return blocks
	

def get_bits(i_num):
	num = abs(i_num)
	if num == 0:
		return 0
	bits = 1
	while (num>>1):
		bits += 1
		num >>= 1
	return bits

def get_blocks_with_bits(filename, comp):		# the first DC coef will be actual value (not difference)
	ff = filename.split("|")
	blocks = []
	for f in ff:
		t_blocks = open(f).readlines()
		for i in range(len(t_blocks)):
			s = t_blocks[i][:-2].split(" ")
			ii = []
			if s[0] == comp + ":":
				for j in range(1, len(s)):
					if j==1:
						ii.append(int(s[j]))
					else:
						ii.append(get_bits(abs(int(s[j]))))
				blocks.append(ii)
	return blocks
	
def get_blocks_all_in_bits(filename, comp):   # the first DC coef will be the bits of the difference, not actual value
	ff = filename.split("|")
	blocks = []
	for f in ff:
		t_blocks = open(f).readlines()
		last_dc = 0
		for i in range(len(t_blocks)):
			s = t_blocks[i][:-2].split(" ")
			ii = []
			if s[0] == comp + ":":
				for j in range(1, len(s)):
					if j==1:
						ii.append(get_bits(abs(int(s[j]) - last_dc)))
						last_dc = int(s[j])
					else:
						ii.append(get_bits(abs(int(s[j]))))
				blocks.append(ii)
	return blocks
	
def get_blocks_difference_all_in_bits(filename, comp):   # same to above function, but for AC it will calculate the bits of the difference
	ff = filename.split("|")
	blocks = []
	for f in ff:
		t_blocks = open(f).readlines()
		last_dc = 0
		last_block = [0]*65
		for i in range(len(t_blocks)):
			s = t_blocks[i][:-2].split(" ")
			ii = []
			if s[0] == comp + ":":
				for j in range(1, len(s)):
					if j==1:
						ii.append(get_bits(abs(int(s[j]) - last_dc)))
						last_dc = int(s[j])
					else:
						if int(last_block[j]) != int(s[j]) and int(last_block[j])*int(s[j])>0:#abs(int(last_block[j])) > 3:						
							print int(last_block[j]), int(s[j]), abs(int(s[j]) - int(last_block[j]))
							ii.append(get_bits(abs(int(s[j]) - int(last_block[j]))))
						else:
							ii.append(get_bits(abs(int(s[j]))))
				last_block = s
				blocks.append(ii)
	return blocks	
	
def get_entropy(prob):
	if prob == 0:
		return INT_MAX
	return int(math.ceil(-math.log(prob, 2)))
	
def get_predicted_run(b, b_pre, start, end):
	intra_block = 0
	for i in range(start):
		if b[i] == 0:
			intra_block += 1
	intra_block = min(16, intra_block)

	return min(intra_block, 10)

def get_predicted_size(b, b_pre, start, end):
	intra_block = 0
	t = 0
	c = 0
	if start == 1:
		intra_block = min(10, b[0])
	else:
		for i in range(1, start):
			if b[i]:
				t += b[i]
				c += 1
		if c:
			intra_block = t*1.0/c

	return int(intra_block)
	
def get_dependant_value(b, i):
	if i==1:
		return b[0]
	t = 0
	for x in range(1, i):
		t += b[x]
	return int(t*(0.3*(i/10)+1)/(i - 1))
	
def huff_encode(symb2freq, jpeg_code):
	# give 0 occurence value a reasonable probability, right now proportional to JPEG default table
	t = 0
	for x in symb2freq:
		t += symb2freq[x]
		
	# no data to infer huffman table, using default
	if not t:
		return deepcopy(jpeg_code)
	
	#Huffman encode the given dict mapping symbols to weights
	heap = [[wt, [sym, ""]] for sym, wt in symb2freq.items()]
	heapify(heap)
	while len(heap) > 1:
		lo = heappop(heap)
		hi = heappop(heap)
		for pair in lo[1:]:
			pair[1] = '0' + pair[1]
		for pair in hi[1:]:
			pair[1] = '1' + pair[1]
		heappush(heap, [lo[0] + hi[0]] + lo[1:] + hi[1:])

	temp = sorted(heappop(heap)[1:], key=lambda p: (len(p[-1]), p))
	ret = {}
	for p in temp:
		ret[p[0]] = len(p[1])
	return ret

def huff_encode_entropy_plus_extra(symb2freq, jpeg_code):
	t = 0
	for x in symb2freq:
		t += symb2freq[x]
		
	# no data to infer huffman table, using default
	if not t:
		return deepcopy(jpeg_code)

	extra_t = t*0.01
	for x in symb2freq:
		if not symb2freq[x]:
			symb2freq[x] = extra_t * math.sqrt(pow(2, - jpeg_code[x]))
		
	ret = {}
	for x in symb2freq:
		ret[x] = -math.log(symb2freq[x]*1.0/t, 2)
	return ret

def huff_encode_entropy(symb2freq, jpeg_code):
	t = 0
	for x in symb2freq:
		t += symb2freq[x]
		
	# no data to infer huffman table, using default
	if not t:
		return deepcopy(jpeg_code)
		
	ret = {}
	for x in symb2freq:
		ret[x] = -math.log(symb2freq[x]*1.0/t, 2)
	return ret

def huff_encode_plus_extra(symb2freq, jpeg_code):
	# give 0 occurence value a reasonable probability, right now proportional to JPEG default table
	t = 0
	for x in symb2freq:
		t += symb2freq[x]
		
	# no data to infer huffman table, using default
	if not t:
		return deepcopy(jpeg_code)
	
	extra_t = t*0.01
	for x in symb2freq:
		if not symb2freq[x]:
			symb2freq[x] = extra_t * math.sqrt(pow(math.e, - jpeg_code[x]))
			
	#Huffman encode the given dict mapping symbols to weights
	heap = [[wt, [sym, ""]] for sym, wt in symb2freq.items()]
	heapify(heap)
	while len(heap) > 1:
		lo = heappop(heap)
		hi = heappop(heap)
		for pair in lo[1:]:
			pair[1] = '0' + pair[1]
		for pair in hi[1:]:
			pair[1] = '1' + pair[1]
		heappush(heap, [lo[0] + hi[0]] + lo[1:] + hi[1:])

	temp = sorted(heappop(heap)[1:], key=lambda p: (len(p[-1]), p))
	ret = {}
	for p in temp:
		ret[p[0]] = len(p[1])
	return ret
    
def get_predicted_SIZE1(b, b_pre, start, end):
	global weight1
	intra_block = 0
	for i in range(start):
		if b[i] == 0:
			intra_block += 1
	intra_block = min(16, intra_block)
	
	inter_block = 0
	for i in range(start, 64):
		if b_pre[i]:
			break
		else:
			inter_block += 1
			if inter_block == 16:
				break
	#weight = 0 #0.7 + b[0]*0.3/11    # adjust weight on these two blocks' difference				
	#inter_block = int(inter_block*1.0/(64 - start)*16)
	return min(int(weight1*inter_block + (1-weight1)*intra_block), 10)

def get_predicted_size(b, b_pre, start, end):
	global weight2
	intra_block = 0
	t = 0
	c = 0
	if start == 1:
		intra_block = min(10, b[0])
	else:
		for i in range(1, start):
			if b[i]:
				t += b[i]
				c += 1
		if c:
			intra_block = t*1.0/c

	inter_block = 0
	for i in range(start, 64):
		if b_pre[i]:
			inter_block = b_pre[i]
			break
	#weight = 0 #0.7 + b[0]*0.3/11    # adjust weight on these two blocks' difference
	return int(weight2*inter_block + (1-weight2)*intra_block)    
	
def check_startpoint(b, i):    # determine is there a SIZE1-length code; most of the cases, if previou number is non-zero, then it's a SIZE1-length code; however, if previous is 16x 0s, it's still a new start
	if (i>1 and b[i-1]) or i==1:
		return True
	f = True
	for ii in range(i, 64):
		if b[ii]:
			f = False
			break
	if f:
		return False
	z = 0
	for ii in range(i - 1, 0, -1):
		if b[ii]:
			break
		z += 1
	if z % 16 == 0:
		return True
	return False

def get_avg_pre_coef(b, i):
	global avg_coef
	if i==1:
		return min(10, b[0])
	t = 0
	ma = 0
	for x in range(1, i):
		t += b[x]
		ma += avg_coef[x]
	return scale(t*1.0/ma, i)

def get_avg_pre_actual_coef(b, b_o, i):
	global avg_coef, avg_actual_coef
	if i==1:
		#return min(10, b[0])
		return scale_actual_coef(abs(b_o[0]*1.0/avg_actual_coef[0]), i)
	t = 0
	ma = 0
	for x in range(1, i):
		t += abs(b_o[x])
		ma += avg_actual_coef[x]
	return scale_actual_coef(t*1.0/ma, i)
	
	
def scale(f, i):
	global apc_bins
	for x in range(len(apc_bins[i])):
		if f < apc_bins[i][x]:
			return x
	return len(apc_bins[i])
	
def scale_actual_coef(f, i):
	global aapc_bins
	for x in range(len(aapc_bins[i])):
		if f < aapc_bins[i][x]:
			return x
	return len(aapc_bins[i])	


def get_dep(blocks, blocks_o, now, s, e, dep):
	global apc_bins, avg_coef
	if dep == 0:
		return min(10, blocks[now][0])
	if dep == 1:
		return get_avg_pre_coef(blocks[now], s)
	if dep == 2:
		return get_avg_pre_coef(get_previous_block(blocks, now), s)
	if dep == 3:
		t = 0
		b_pre = get_previous_block(blocks, now)
		for i in range(s, min(s+6, 63) + 1):
			if b_pre[i]:
				return b_pre[i]
		return 0
		
		
		t = 0
		if blocks[now][0] > 5:
			return 11
		b_pre = get_previous_block(blocks, now)
		for i in range(s, min(s+6, 63) + 1):
			if b_pre[i]:
				return b_pre[i]
		return 0
		
		ss = max(s - 2, 1)
		ee = min(s + 2, 63)
		t = 0.0
		for i in range(ss, ee+1):
			t += b_pre[i]*1.0/avg_coef[i]
		return int(t/(ee + 1 - ss)*10)
		#return b_pre[s]
	if dep == 4:
		b = blocks[now]
		return b[s-1]
		i = 63
		while i > 0:
			if b_pre[i]:
				break
			i -= 1
		if i >= 40:
			return 10
		else:
			return i/4
	if dep == 5:
		su = 0
		ma = 0
		sign = 0
		n = 0
		pos = -1
		for x in range(now - 1, max(0, now - 6), -1):
			if blocks[x+1][0] > 5:
				break
			for xx in range(s, min(64, s+5)):
				ma += avg_coef[xx]
				if blocks[x][xx]:
					if pos == -1:
						pos = xx
					else:
						if xx == pos:
							sign += blocks_o[x][xx]
							n += 1
					su += blocks[x][xx]
					break

#		if not ma:
#			return 21
		if not ma:
			if blocks[now][0] > 11:
				print "DC out of range", blocks[now]
			return len(apc_bins[1]) + blocks[now][0] - 5
		return scale(su*1.0/ma, s)
	if dep == 6:
		su = 0
		ma = 0
		sign = 0
		n = 0
		pos = -1
		for x in range(now - 1, max(0, now - 2), -1):
			if blocks[x+1][0] > 2:
				break
			for xx in range(s, min(64, s+5)):
				ma += avg_coef[xx]
				if blocks[x][xx]:
					if pos == -1:
						pos = xx
					else:
						if xx == pos:
							sign += blocks_o[x][xx]
							n += 1
					su += blocks[x][xx]
					break
		if ma == 0:
			return get_dep(blocks, blocks_o, now, s, e, 3)
		return scale(su*1.0/ma, s) + 12
	
	if dep == 7:
		return get_avg_pre_actual_coef(blocks[now], blocks_o[now], s)
		
	if dep == 8:
		if s==1:
			return int(abs(blocks_o[now][0]*200.0/avg_actual_coef[0]))
		t = 0
		ma = 0
		for x in range(1, s):
			t += abs(blocks_o[now][x])
			ma += avg_actual_coef[x]
		return int(t*200.0/ma)
	if dep == 9:
		su = 0
		ma = 0
		sign = 0
		n = 0
		pos = -1
		for x in range(now - 1, max(0, now - 1), -1):
			if blocks[x+1][0] > 5:
				break
			for xx in range(s, min(64, s+5)):
				ma += avg_coef[xx]
				if blocks[x][xx]:
					if pos == -1:
						pos = xx
					else:
						if xx == pos:
							sign += blocks_o[x][xx]
							n += 1
					su += blocks[x][xx]
					break

#		if not ma:
#			return 21
		if not ma:
			if blocks[now][0] > 11:
				print "DC out of range", blocks[now]
			return len(apc_bins[1]) + blocks[now][0] - 5
		return scale(su*1.0/ma, s)
	if dep == -1:
		return 0

def record_code(b, b_o, now, c, start, end, oc):
	global dep1, dep2, wrong_keys
	d1 = get_dep(b, b_o, now, start, end, dep1)
	d2 = get_dep(b, b_o, now, start, end, dep2)
	if d1<len(oc[start]) and d2<len(oc[start][d1]):
		oc[start][d1][d2][c] += 1
	else:
		wrong_keys += 1
	return start, d1, d2, c
	
def record_jpeg(b, b_o, now, c, start, end, oc):
	global dep1, dep2, code, wrong_keys, wrong_desc, wrong_saw
	d1 = get_dep(b, b_o, now, start, end, dep1)
	d2 = get_dep(b, b_o, now, start, end, dep2)
	if d1<len(oc[start]) and d2<len(oc[start][d1]):
		oc[start][d1][d2] += code[abs(c)]
	else:
		wrong_keys += 1
		if not wrong_saw:
			wrong_desc = []
			wrong_desc.append(d1)
			wrong_desc.append(d2)
			for i in range(1,64):
				wrong_desc.append(len(apc_bins[i]))
			wrong_desc.append(b[now])
			wrong_desc.append(b_o[now])
			wrong_saw = True		
		

def parse_dep(s, apc_bins):
	if s == "0": 
		return 0, 10
	elif s == "1": #avg_pre_coef
		return 1, len(apc_bins[1]) + 1
	elif s == "2": #avg_pre_block_coef
		return 2, len(apc_bins[1]) + 1
	elif s == "3": #pre_block_coef
		return 3, 11
	elif s == "4":
		return 4, 10
	elif s == "5":
		return 5, len(apc_bins[1]) + 6
	elif s == "6":
		return 6, len(apc_bins[1]) + 12
	elif s == "7":
		return 7, len(aapc_bins[1]) + 11
	elif s == "8": # for bin separator
		return 8, 200
	elif s == "9":
		return 9, len(apc_bins[1]) + 6
	else:
		return -1, 0
	

def fprint(string):
	global index_file
	print string
	index_file.write(string + "\n")

def fprint_(string):
	global index_file
	print string
	index_file.write(string)	
	
def fprint_close():
	global index_file
	index_file.close()
	
def get_previous_block(b, n):
	if n==0:
		return [0]*64
	else:
		return b[n-1]	

def generate_blocks(folder):
	f_blocks = glob.glob(folder + "/*.block")
	f_jpgs = glob.glob(folder + "/*.jpg")
	if len(f_blocks) != len(f_jpgs):
		os.system("rm *.blocks")
	else:
		return
	
	for f in f_jpgs:
		name = f[f.rfind("/") + 1 : ]
		sys.stdout.flush()
		cmd = "jpegtran -outputcoef " + folder + "/" + name + ".block " + f + " temp.out"
		os.system(cmd)
	os.system("rm temp.out")

def get_deps_from_file(f):
	ls = open(f).readlines()[0].split(" ")
	return ls[0], ls[1]
	
def get_deps_from_file_partial(f):
	ls = open(f).readlines()[0].split(" ")
	return ls[0], ls[1], ls[2], ls[3]
	
def get_max_pos_value(folder, comp):
	fprint("calculating max_pos_value...")
	generate_blocks(folder)
	files = glob.glob(folder + "/*.block")
	f = ""
	for i in files:
		f += i + "|"
	blocks = get_blocks_all_in_bits(f[:-1], comp)
	ret = {}
	for x in range(0, 64):
		m = -1
		n = 0
		for ii in range(len(blocks)):
			i = abs(blocks[ii][x])
			if i > m:
				m = i
		ret[x] = m
	return ret
	
def record_code_temp(bs, now, c, start, end, oc):
	b = bs[now]
	if start==1:
		oc[start][int(b[0]/11.0*100)] += 1
		return
	t = 0
	ma = 0
	for x in range(1, start):
		t += b[x]
		ma += avg_coef[x]
	oc[start][int(t*1.0/ma*100)] += 1
	
def get_avg_coef_bins(folder, comp):
	SIZE1 = 100
	fprint("calculating avg_coef_bins...")
	generate_blocks(folder)
	sep = {}
	oc = {}   #oc for occur, then becomes difference
	pos = 1
	for i in range(1, 64):
		oc[i] = {}
		for p in range(SIZE1 + 1):
			oc[i][p] = 0
	files = glob.glob(folder + "/*.block")
	for f in files:
		bs = get_blocks_all_in_bits(f, comp)
		for ii in range(len(bs)):
			b = bs[ii]
			r = 0
			pos = 1
			for i in range(1, 64):
				if b[i] == 0:
					r += 1
					continue
				while (r > 15):
					record_code_temp(bs, ii, 0xf0, pos, pos + 15, oc)
					pos += 16
					r -= 16
				record_code_temp(bs, ii, (r << 4) + b[i], pos, i, oc)
				pos = i + 1
				r = 0
			if r > 0:
				record_code_temp(bs, ii, 0, pos, 63, oc)
	sep = {}
	for i in range(1, 64):
		tc = {}
		tt = 0
		for ii in range(SIZE1 + 1):
			tc[ii] = deepcopy(oc[i][ii])
			tt += oc[i][ii]
			
		t = SIZE1 + 1
		s = []
		for ii in range(SIZE1 + 1):
			s.append([ii])
		now = 0
		tail = SIZE1
		while True:
			a = tc[now]
			#print a,
			if a<tt/20.0:
				merged = tc[now] + tc[now+1]
				tc[now] = deepcopy(merged)
				s[now] += s[now + 1]
				del s[now + 1]

				for ii in range(now + 1, len(s) - 1):
					tc[ii] = deepcopy(tc[ii + 1])
				tail = len(s) - 1
				if now >= tail:
					break
			else:
				now += 1
				if now >= tail:
					break
		t = len(s)
		tt = []
		for ii in range(len(s) - 1):
			tt.append(s[ii][len(s[ii]) - 1]*1.0/100)
		for ii in range(20 - len(tt)):
			tt.append(tt[len(tt) - 1])
		sep[i] = tt
	return sep
	
def init(comp, image_folder, tbl_folder):
	global code, dc_code, avg_coef, apc_bins, avg_actual_coef, aapc_bins, wrong_keys
	if os.path.isfile("bin_separator_600_"+comp):
		pkl_file = open("bin_separator_600_"+comp, 'rb')
		aapc_bins = pickle.load(pkl_file)
		pkl_file.close()

	# max value for each position
	if os.path.isfile(image_folder + "/max_pos_value_" + comp):
		pkl_file = open(image_folder + "/max_pos_value_" + comp)
		avg_coef = pickle.load(pkl_file)
		pkl_file.close()
	else:
		print "regenerating max_pos_values..."
		avg_coef = get_max_pos_value(image_folder, comp)
		pkl_file = open(image_folder + "/max_pos_value_" + comp, 'wb')
		pickle.dump(avg_coef, pkl_file)
		pkl_file.close()
		f = open(tbl_folder + "/plain_max_pos_value_" + comp, 'wb')
		for x in avg_coef:
			f.write(str(x) + ": " + str(avg_coef[x]) + "\n")
		f.close()
	os.system("cp " + image_folder + "/*max_pos_value_" + comp + " " + tbl_folder + "/")

	# coef bins
	if os.path.isfile(image_folder + "/coef_bins_" + comp):
		pkl_file = open(image_folder + "/coef_bins_" + comp)
		apc_bins = pickle.load(pkl_file)
		pkl_file.close()
	else:
		print "regenerating coef_bins..."
		apc_bins = get_avg_coef_bins(image_folder, comp)
		pkl_file = open(image_folder + "/coef_bins_" + comp, 'wb')
		pickle.dump(apc_bins, pkl_file)
		pkl_file.close()
		f = open(tbl_folder + "/plain_coef_bins_" + comp, 'wb')
		for x in apc_bins:
			f.write(str(x) + ": ")
			for y in range(len(apc_bins[x])):
				f.write(str(apc_bins[x][y]) + " ")
			f.write("\n")
		f.close()
	os.system("cp " + image_folder + "/*coef_bins_" + comp + " " + tbl_folder + "/")		

	if comp == "0":
		code = get_luminance_codes()
		dc_code = bits_dc_luminance
		avg_actual_coef = avg_actual_coef_600_0
	else:
		code = get_chrominance_codes()
		dc_code = bits_dc_chrominance
		avg_actual_coef = avg_actual_coef_600_0
	
	wrong_keys = 0

def init_testing(comp, tbl_folder):
	global code, dc_code, avg_coef, apc_bins, avg_actual_coef, aapc_bins
	if os.path.isfile("bin_separator_600_"+comp):
		pkl_file = open("bin_separator_600_"+comp, 'rb')
		aapc_bins = pickle.load(pkl_file)
		pkl_file.close()

	# max value for each position
	if os.path.isfile(tbl_folder + "/max_pos_value_" + comp):
		pkl_file = open(tbl_folder + "/max_pos_value_" + comp)
		avg_coef = pickle.load(pkl_file)
		pkl_file.close()
	
	else:
		print "no max_pos_values..."
		exit()

	# coef bins
	if os.path.isfile(tbl_folder + "/coef_bins_" + comp):
		pkl_file = open(tbl_folder + "/coef_bins_" + comp)
		apc_bins = pickle.load(pkl_file)
		pkl_file.close()
	else:
		print "no coef_bins..."
		exit()

	if comp == "0":
		code = get_luminance_codes()
		dc_code = bits_dc_luminance
		avg_actual_coef = avg_actual_coef_600_0
	else:
		code = get_chrominance_codes()
		dc_code = bits_dc_chrominance
		avg_actual_coef = avg_actual_coef_600_0
		
def bin_separator(bins, s, final_bin_number, total_samples):
	now = 0
	tail = len(bins)
	
	while True:
		a = bins[now]
		#print a,
		if a<total_samples*1.0/final_bin_number:
			merged = bins[now] + bins[now+1]
			bins[now] = deepcopy(merged)
			s[now] += s[now + 1]
			del s[now + 1]

			for ii in range(now + 1, len(s) - 1):
				bins[ii] = deepcopy(bins[ii + 1])
			tail = len(s) - 1
			if now >= tail:
				break
		else:
			now += 1
			if now >= tail:
				break
	t = len(s)
	tt = []
	for ii in range(len(s) - 1):
		tt.append(s[ii][len(s[ii]) - 1])
	for ii in range(final_bin_number - len(tt)):
		tt.append(tt[len(tt) - 1])
	t = len(s)
	return tt		
	
dep1 = 0
dep2 = 0
apc_bins = 0
aapc_bins = 0
avg_coef = 0
avg_actual_coef = 0
index_file = 0
code = 0
dc_code = 0
wrong_keys = 0
wrong_desc = 0
wrong_saw = False
